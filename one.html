<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>200天任务清单 · Suki❤老公</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0f172a;           /* 背景 */
    --card:#111827;         /* 卡片底 */
    --accent:#60a5fa;       /* 主题色 */
    --accent-2:#93c5fd;
    --muted:#94a3b8;        /* 次要文字 */
    --text:#e5e7eb;         /* 主要文字 */
    --success:#34d399;
    --danger:#f87171;
    --table-border:#1f2937;
    --chip:#1e293b;
    --shadow: 0 10px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  body{
    margin:0; background:linear-gradient(180deg,#0b1024 0%, #0f172a 100%);
    color:var(--text); font-family:Inter,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI","PingFang SC","Hiragino Sans GB","Microsoft Yahei",sans-serif;
  }
  .wrap{max-width:1000px; margin:32px auto; padding:0 16px;}
  header{
    position:sticky; top:0; z-index:5; backdrop-filter:blur(10px);
    background:rgba(15,23,42,.7); border-bottom:1px solid rgba(148,163,184,.12);
  }
  .bar{display:flex; gap:12px; flex-wrap:wrap; align-items:center; padding:14px 16px;}
  .brand{font-weight:700; letter-spacing:.2px; margin-right:auto}
  .brand span{color:var(--accent)}
  .card{
    background:var(--card); border:1px solid rgba(148,163,184,.1);
    border-radius:16px; padding:16px; box-shadow:var(--shadow);
  }
  .controls{display:grid; grid-template-columns:repeat(6,minmax(0,1fr)); gap:12px}
  .controls .full{grid-column:1/-1}
  label{display:block; font-size:12px; color:var(--muted); margin-bottom:6px}
  input[type="date"],select,input[type="number"],button{
    width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(148,163,184,.18);
    background:#0b1224; color:var(--text); outline:none;
  }
  input::placeholder{color:#94a3b8}
  button{
    cursor:pointer; border:1px solid rgba(147,197,253,.35);
    background:linear-gradient(180deg,var(--accent),#3b82f6); color:#081223; font-weight:700;
    transition:.18s transform ease, .18s filter ease;
  }
  button:active{transform:translateY(1px)}
  .ghost{
    background:#0b1224; color:var(--text); border:1px solid rgba(148,163,184,.25);
  }
  .chips{display:flex; gap:8px; flex-wrap:wrap}
  .chip{
    padding:6px 10px; background:var(--chip); border:1px solid rgba(148,163,184,.15);
    border-radius:999px; font-size:12px; cursor:pointer; user-select:none;
  }
  .chip:hover{border-color:var(--accent-2); color:var(--accent-2)}
  /* 表格 */
  table{width:100%; border-collapse:separate; border-spacing:0 8px}
  thead th{
    text-align:left; font-size:12px; color:var(--muted); font-weight:600; padding:0 10px 8px;
    position:sticky; top:68px; background:transparent; backdrop-filter:blur(10px);
  }
  tbody tr{
    background:linear-gradient(180deg,#0d1429,#0a1022); border:1px solid var(--table-border);
  }
  tbody td{
    padding:12px 10px; border-top:1px solid var(--table-border); border-bottom:1px solid var(--table-border);
  }
  tbody tr:first-child td{border-top-left-radius:12px; border-top-right-radius:12px}
  tbody tr:last-child td{border-bottom-left-radius:12px; border-bottom-right-radius:12px}
  .date{font-weight:600}
  .weekday{color:var(--muted)}
  .weekend .weekday{color:var(--danger)}
  .done-cell{width:120px}
  .note input{
    width:100%; padding:8px 10px; border-radius:8px; border:1px solid rgba(148,163,184,.2);
    background:#0b1224; color:var(--text);
  }
  /* 自定义复选框 */
  .check{
    appearance:none; width:22px; height:22px; border-radius:6px;
    border:2px solid rgba(148,163,184,.35); background:#0b1224; cursor:pointer; display:inline-grid; place-items:center;
    transition:.15s;
  }
  .check:checked{
    background:linear-gradient(180deg,#34d399,#10b981); border-color:rgba(16,185,129,.7);
  }
  .check:checked::after{content:"✔"; color:#06251b; font-weight:900; font-size:14px}
  /* 页脚 */
  footer{color:var(--muted); text-align:center; font-size:12px; margin:28px 0 16px}
  .stat{display:flex; gap:10px; align-items:center; color:var(--muted)}
  .pill{padding:6px 10px; border-radius:999px; background:#0b1224; border:1px solid rgba(148,163,184,.15)}
  @media (max-width:720px){
    .controls{grid-template-columns:1fr 1fr}
    thead{display:none}
    tbody td{display:block; padding:10px 12px}
    tbody tr{display:grid; grid-template-columns:1fr auto; row-gap:8px; padding:6px 8px}
    .note{grid-column:1/-1}
    .done-cell{justify-self:end}
  }
</style>
</head>
<body>
  <header>
    <div class="bar">
      <div class="brand">Suki<span>❤</span>老公 · 任务清单</div>
      <div class="stat"><span class="pill" id="countInfo">已完成 0 / 0</span></div>
    </div>
  </header>

  <div class="wrap">
    <div class="card" style="margin-bottom:16px">
      <div class="controls">
        <div>
          <label>年份快速选择</label>
          <select id="yearSelect"></select>
        </div>
        <div>
          <label>起始日期</label>
          <input type="date" id="startDate">
        </div>
        <div>
          <label>天数</label>
          <input type="number" id="days" min="1" max="3650" value="200">
        </div>
        <div>
          <label>快捷</label>
          <div class="chips">
            <div class="chip" data-q="today">今天开始</div>
            <div class="chip" data-q="nextMon">下周一</div>
            <div class="chip" data-q="jan1">该年1月1日</div>
          </div>
        </div>
        <div>
          <label>操作</label>
          <button id="genBtn">生成清单</button>
        </div>
        <div>
          <label>数据</label>
          <button class="ghost" id="clearBtn" title="只清除勾选与备注，不改日期">清除本地记录</button>
        </div>
      </div>
    </div>

    <div class="card">
      <table>
        <thead>
          <tr>
            <th style="width:180px">日期</th>
            <th>星期</th>
            <th class="done-cell">完成</th>
            <th>备注</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <footer>（Suki抱抱老公）每一次打勾，都是你更靠近目标的一步。</footer>
  </div>

<script>
  const $ = (s, el=document)=>el.querySelector(s);
  const $$ = (s, el=document)=>Array.from(el.querySelectorAll(s));

  const tbody = $("#tbody");
  const yearSelect = $("#yearSelect");
  const startDateInput = $("#startDate");
  const daysInput = $("#days");
  const genBtn = $("#genBtn");
  const clearBtn = $("#clearBtn");
  const countInfo = $("#countInfo");

  const STORAGE_PREFIX = "todo-"; // key = todo-YYYY-MM-DD
  const META_KEY = "todo-meta";   // 保存起始日期与天数

  init();

  function init(){
    // 年份下拉：当前年±5年
    const curY = new Date().getFullYear();
    for(let y = curY + 5; y >= curY - 5; y--){
      const opt = document.createElement("option");
      opt.value = y; opt.textContent = y + " 年";
      if(y === curY) opt.selected = true;
      yearSelect.appendChild(opt);
    }
    // 默认起始日期=今天
    startDateInput.valueAsDate = new Date();

    // 绑定
    yearSelect.addEventListener("change", ()=>{
      // 不改具体日期，只用于快速选择“该年1月1日”按钮
    });

    $(".chips").addEventListener("click", (e)=>{
      const tag = e.target.closest(".chip");
      if(!tag) return;
      const mode = tag.dataset.q;
      if(mode === "today"){
        startDateInput.valueAsDate = new Date();
      }else if(mode === "nextMon"){
        const d = new Date(); const day = d.getDay(); // 0-6, 周日=0
        const delta = ((1 - day) + 7) % 7 || 7; // 下周一
        d.setDate(d.getDate() + delta);
        startDateInput.valueAsDate = d;
      }else if(mode === "jan1"){
        const y = parseInt(yearSelect.value,10);
        startDateInput.value = `${y}-01-01`;
      }
    });

    genBtn.addEventListener("click", build);
    clearBtn.addEventListener("click", clearLocal);

    // 尝试恢复上次的视图
    const meta = JSON.parse(localStorage.getItem(META_KEY) || "null");
    if(meta){
      startDateInput.value = meta.start;
      daysInput.value = meta.days;
      const metaYear = new Date(meta.start).getFullYear();
      const opt = Array.from(yearSelect.options).find(o=>parseInt(o.value,10)===metaYear);
      if(opt) yearSelect.value = String(metaYear);
      build();
    }else{
      build(); // 用默认值渲染一次
    }
  }

  function build(){
    const start = new Date(startDateInput.value);
    const days = clamp(parseInt(daysInput.value,10) || 200, 1, 3650);

    // 记录元信息
    localStorage.setItem(META_KEY, JSON.stringify({start: fmtDate(start), days}));

    tbody.innerHTML = "";
    let doneCount = 0;

    for(let i=0;i<days;i++){
      const d = new Date(start); d.setDate(start.getDate()+i);
      const key = STORAGE_PREFIX + fmtDate(d);
      const saved = JSON.parse(localStorage.getItem(key) || "null") || {};
      const wd = "日一二三四五六"[d.getDay()];
      const isWeekend = (d.getDay()===0 || d.getDay()===6);

      const tr = document.createElement("tr");
      if(isWeekend) tr.classList.add("weekend");
      tr.innerHTML = `
        <td class="date">${fmtDate(d)}</td>
        <td class="weekday">周${wd}</td>
        <td class="done-cell"><input class="check" type="checkbox" ${saved.done ? "checked":""} aria-label="完成" /></td>
        <td class="note"><input type="text" placeholder="给今天留一句话…" value="${saved.note?escapeHTML(saved.note):""}"></td>
      `;
      // 事件
      const check = $(".check", tr);
      const note = $(".note input", tr);

      check.addEventListener("change", ()=>{
        saveRow(key, {done: check.checked, note: note.value});
        updateCount();
      });
      note.addEventListener("input", debounce(()=>{
        saveRow(key, {done: check.checked, note: note.value});
      }, 200));

      tbody.appendChild(tr);
      if(saved.done) doneCount++;
    }
    updateCount(doneCount, days);
  }

  function saveRow(key, data){
    localStorage.setItem(key, JSON.stringify(data));
  }

  function clearLocal(){
    if(!confirm("清除本页面的所有勾选与备注？（日期设置保留）")) return;
    const keys = Object.keys(localStorage);
    for(const k of keys){
      if(k.startsWith(STORAGE_PREFIX)) localStorage.removeItem(k);
    }
    build();
  }

  function updateCount(initDone=null, total=null){
    if(initDone!==null){
      countInfo.textContent = `已完成 ${initDone} / ${total}`;
      return;
    }
    const rows = $$("tbody tr");
    const checked = rows.filter(r => $(".check", r).checked).length;
    countInfo.textContent = `已完成 ${checked} / ${rows.length}`;
  }

  // 工具
  function fmtDate(d){
    const y=d.getFullYear(), m=String(d.getMonth()+1).padStart(2,"0"), day=String(d.getDate()).padStart(2,"0");
    return `${y}-${m}-${day}`;
  }
  function clamp(n,min,max){return Math.max(min, Math.min(max,n))}
  function debounce(fn, wait){
    let t=null; return function(...args){ clearTimeout(t); t=setTimeout(()=>fn.apply(this,args), wait); };
  }
  function escapeHTML(str){
    return str.replace(/[&<>"']/g, s=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[s]));
  }
</script>
</body>
</html>
